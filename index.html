<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CampusHub</title>
  <style>
    /* ðŸŒˆ General Styles */
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #004aad, #007bff);
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #333;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    h1 {
      color: #004aad;
      margin-bottom: 1.5rem;
    }

    .form-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .form-container input {
      padding: 0.8rem;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 1rem;
    }

    .form-container button {
      background: #004aad;
      color: white;
      border: none;
      padding: 0.8rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }

    .form-container button:hover {
      background: #0068d6;
    }

    .google-btn {
      background: white;
      color: #444;
      border: 1px solid #ccc;
    }

    .google-btn:hover {
      background: #f5f5f5;
    }

    .hidden {
      display: none;
    }

    p {
      font-size: 0.9rem;
    }

    a {
      color: #004aad;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    #signupMessage, #loginMessage {
      color: red;
      font-size: 0.9rem;
    }

    /* ðŸŒŸ Sells Page */
    .sells-page {
      display: none;
      background-color: #f4f6fb;
      width: 100%;
      height: 100vh;
      flex-direction: column;
    }

    .header {
      background-color: #004aad;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.2rem;
      position: sticky;
      top: 0;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }

    .product-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      text-align: center;
      padding: 0.5rem;
      transition: 0.3s;
    }

    .product-card:hover {
      transform: translateY(-5px);
    }

    .product-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 10px;
    }

    .basket-icon {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: #004aad;
      color: white;
      font-size: 1.8rem;
      padding: 0.8rem 1rem;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    #cartCount {
      background: #ff3b3b;
      color: white;
      font-size: 0.8rem;
      border-radius: 50%;
      padding: 3px 7px;
      position: absolute;
      top: 5px;
      right: 5px;
    }
  </style>
</head>

<body>
  <!-- ðŸ”¹ Auth Container -->
  <div class="container" id="authContainer">
    <h1>CampusHub</h1>

    <!-- Sign Up Form -->
    <div class="form-container" id="signupForm">
      <h2>Create Account</h2>
      <input type="text" id="signupName" placeholder="Full Name" required />
      <input type="email" id="signupEmail" placeholder="Email" required />
      <input type="tel" id="signupPhone" placeholder="Phone Number" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" required />
      <button id="signupBtn">Sign Up</button>
      <p id="signupMessage"></p>
      <p>Already have an account? <a href="#" id="toLogin">Sign In</a></p>
      <button id="googleSignup" class="google-btn">Continue with Google</button>
    </div>

    <!-- Sign In Form -->
    <div class="form-container hidden" id="loginForm">
      <h2>Sign In</h2>
      <input type="email" id="loginEmail" placeholder="Email" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <button id="loginBtn">Sign In</button>
      <p id="loginMessage"></p>
      <p><a href="#" id="forgotPassword">Forgot Password?</a></p>
      <p>Donâ€™t have an account? <a href="#" id="toSignup">Sign Up</a></p>
      <button id="googleLogin" class="google-btn">Continue with Google</button>
    </div>
  </div>

  <!-- ðŸ›ï¸ Sells Page -->
  <div class="sells-page" id="sellsPage">
    <div class="header">
      Welcome, <span id="userName">User</span>
      <button id="logoutBtn" style="float:right; background:transparent; color:white; border:none;">Logout</button>
    </div>
    <div class="product-grid" id="productGrid"></div>
    <div class="basket-icon" id="basketIcon">ðŸ›’<span id="cartCount">0</span></div>
  </div>

  <!-- ðŸ”¥ Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth, createUserWithEmailAndPassword, sendEmailVerification,
      signInWithEmailAndPassword, sendPasswordResetEmail,
      GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import {
      getFirestore, setDoc, doc, getDoc
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBdylCZumZk-YrN9Fn13qQ6XRTN5WGsi54",
      authDomain: "campus-hub-c621e.firebaseapp.com",
      projectId: "campus-hub-c621e",
      storageBucket: "campus-hub-c621e.firebasestorage.app",
      messagingSenderId: "853234117468",
      appId: "1:853234117468:web:b83b9d89c808c2ae94af99",
      measurementId: "G-YQGNYWFV0L"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const authContainer = document.getElementById("authContainer");
    const sellsPage = document.getElementById("sellsPage");

    const signupForm = document.getElementById("signupForm");
    const loginForm = document.getElementById("loginForm");
    const toLogin = document.getElementById("toLogin");
    const toSignup = document.getElementById("toSignup");
    const signupBtn = document.getElementById("signupBtn");
    const loginBtn = document.getElementById("loginBtn");
    const googleSignup = document.getElementById("googleSignup");
    const googleLogin = document.getElementById("googleLogin");
    const forgotPassword = document.getElementById("forgotPassword");
    const logoutBtn = document.getElementById("logoutBtn");

    const userName = document.getElementById("userName");
    const productGrid = document.getElementById("productGrid");
    const cartCount = document.getElementById("cartCount");
    const basketIcon = document.getElementById("basketIcon");

    let cart = [];

    // Toggle Forms
    toLogin.onclick = () => { signupForm.classList.add("hidden"); loginForm.classList.remove("hidden"); };
    toSignup.onclick = () => { loginForm.classList.add("hidden"); signupForm.classList.remove("hidden"); };

    // Password reset
    forgotPassword.onclick = async () => {
      const email = prompt("Enter your email to reset password:");
      if (email) {
        try { await sendPasswordResetEmail(auth, email); alert("Reset link sent!"); }
        catch (e) { alert(e.message); }
      }
    };

    // Sign Up
    signupBtn.onclick = async () => {
      const name = signupName.value.trim();
      const email = signupEmail.value.trim();
      const phone = signupPhone.value.trim();
      const pass = signupPassword.value;
      const confirm = signupConfirmPassword.value;
      const msg = document.getElementById("signupMessage");

      if (!name || !email || !phone || !pass || !confirm) return msg.textContent = "Please fill all fields";
      if (pass !== confirm) return msg.textContent = "Passwords do not match";

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await sendEmailVerification(cred.user);
        await setDoc(doc(db, "users", cred.user.uid), { name, email, phone });
        msg.textContent = "Check your email to verify your account.";
      } catch (e) { msg.textContent = e.message; }
    };

    // Sign In
    loginBtn.onclick = async () => {
      const email = loginEmail.value.trim();
      const pass = loginPassword.value;
      const msg = document.getElementById("loginMessage");

      try {
        const cred = await signInWithEmailAndPassword(auth, email, pass);
        if (!cred.user.emailVerified) return msg.textContent = "Verify your email first!";
        showSellsPage(cred.user);
      } catch (e) {
        msg.textContent = (e.code === "auth/user-not-found") ? "Account not found. Please sign up." : e.message;
      }
    };

    // Google Auth
    googleSignup.onclick = googleLogin.onclick = async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        await setDoc(doc(db, "users", user.uid), {
          name: user.displayName, email: user.email, phone: user.phoneNumber || ""
        }, { merge: true });
        showSellsPage(user);
      } catch (e) { alert("Google sign-in failed: " + e.message); }
    };

    // Show Sells Page
    async function showSellsPage(user) {
      authContainer.style.display = "none";
      sellsPage.style.display = "flex";

      const docSnap = await getDoc(doc(db, "users", user.uid));
      const name = docSnap.exists() ? docSnap.data().name : user.email.split("@")[0];
      userName.textContent = name;

      renderProducts();
    }

    // Logout
    logoutBtn.onclick = async () => {
      await signOut(auth);
      sellsPage.style.display = "none";
      authContainer.style.display = "block";
    };

    // Example Products
    const products = [
      { id: 1, name: "Wireless Earbuds", price: 1200, image: "https://images.unsplash.com/photo-1585386959984-a41552231693?w=400" },
      { id: 2, name: "Laptop Bag", price: 1800, image: "https://images.unsplash.com/photo-1612965607440-df8e8d58b7d4?w=400" },
      { id: 3, name: "Smart Watch", price: 2500, image: "https://images.unsplash.com/photo-1598970434795-0c54fe7c0649?w=400" },
      { id: 4, name: "Sneakers", price: 3200, image: "https://images.unsplash.com/photo-1552346154-21d32810aba3?w=400" },
      { id: 5, name: "Power Bank", price: 1500, image: "https://images.unsplash.com/photo-1580894908360-7873a0e72df9?w=400" },
    ];

    function renderProducts() {
      productGrid.innerHTML = "";
      products.forEach(p => {
        const card = document.createElement("div");
        card.classList.add("product-card");
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>Ksh ${p.price}</p>
          <button>Add to Cart</button>`;
        card.querySelector("button").onclick = () => addToCart(p);
        productGrid.appendChild(card);
      });
    }

    function addToCart(p) {
      cart.push(p);
      cartCount.textContent = cart.length;
      alert(`${p.name} added to basket!`);
    }

    basketIcon.onclick = () => alert("Proceeding to checkout page (coming soon).");
  </script>
</body>
</html>
